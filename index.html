<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EntryPlan Academy — Systems Online</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cormorant:ital,wght@0,300;0,400;0,600;0,700;1,300&family=DM+Mono:wght@300;400;500&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --void: #020508;
  --deep: #060c12;
  --panel: #080f18;
  --surface: #0c1520;
  --border: #0f2030;
  --border2: #1a3348;
  --gold: #f0b429;
  --gold2: #ffd166;
  --gold-dim: rgba(240,180,41,0.15);
  --gold-glow: rgba(240,180,41,0.4);
  --cyan: #00d4ff;
  --cyan2: #7ef6ff;
  --cyan-dim: rgba(0,212,255,0.12);
  --cyan-glow: rgba(0,212,255,0.35);
  --green: #00ff88;
  --green-dim: rgba(0,255,136,0.12);
  --red: #ff3366;
  --red-dim: rgba(255,51,102,0.12);
  --purple: #8b5cf6;
  --text: #ffffff;
  --text2: #b0cfe8;
  --text3: #7aaabb;
}

* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; }

body {
  font-family: 'Inter', sans-serif;
  background: var(--void);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  cursor: crosshair;
}

/* ── STAR CANVAS ── */
#cv { position:fixed; inset:0; z-index:0; pointer-events:none }

/* ── NEBULA ── */
.neb { position:fixed; inset:0; z-index:0; pointer-events:none }
.neb-a {
  background:
    radial-gradient(ellipse 70% 50% at 10% 22%, rgba(8,28,100,.22)   0%,transparent 60%),
    radial-gradient(ellipse 55% 65% at 88% 72%, rgba(5,18,80,.18)    0%,transparent 55%),
    radial-gradient(ellipse 40% 40% at 52% 48%, rgba(2,10,50,.10)    0%,transparent 70%);
  animation:nda 55s ease-in-out infinite alternate;
}
.neb-b {
  background:
    radial-gradient(ellipse 45% 70% at 68% 10%, rgba(8,35,110,.12) 0%,transparent 58%),
    radial-gradient(ellipse 60% 30% at 20% 82%, rgba(4,22,80,.09)  0%,transparent 52%);
  animation:ndb 72s ease-in-out infinite alternate;
}
@keyframes nda { from{transform:scale(1) translate(0,0)} to{transform:scale(1.09) translate(22px,-18px)} }
@keyframes ndb { from{transform:scale(1) translate(0,0)} to{transform:scale(1.06) translate(-18px,24px)} }

/* ── SPACECRAFT CANVAS ── */
#ship-cv { position:fixed; inset:0; z-index:1; pointer-events:none }

/* SCAN LINE */
body::after {
  content: '';
  position: fixed; inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.05) 2px,
    rgba(0,0,0,0.05) 4px
  );
  pointer-events: none; z-index: 1;
}

/* ── LOADING SCREEN ── */
#loading {
  position: fixed; inset: 0;
  background: var(--void);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  z-index: 9999;
  transition: opacity 1.4s cubic-bezier(.4,0,.2,1);
}
.ld-orrery {
  width: 96px; height: 96px;
  position: relative; margin-bottom: 36px;
  display: flex; align-items: center; justify-content: center;
}
.ld-orrery::before {
  content: ''; position: absolute; inset: 0; border-radius: 50%;
  border: 1px solid transparent;
  border-top-color: var(--cyan);
  border-left-color: rgba(0,212,255,0.35);
  animation: spin 2.2s linear infinite;
  box-shadow: 0 0 28px var(--cyan-glow), inset 0 0 12px rgba(0,212,255,0.06);
}
.ld-orrery::after {
  content: ''; position: absolute; inset: 16px; border-radius: 50%;
  border: 1px solid rgba(0,212,255,0.12);
  border-bottom-color: rgba(0,212,255,0.45);
  animation: spin 3.8s linear infinite reverse;
}
.ld-core {
  width: 9px; height: 9px;
  background: var(--text);
  border-radius: 50%; z-index: 1;
  box-shadow: 0 0 16px var(--cyan), 0 0 32px var(--cyan-glow), 0 0 64px rgba(0,212,255,0.15);
}
@keyframes spin { to { transform: rotate(360deg) } }

.ld-wordmark {
  font-family: 'Cormorant', serif;
  font-size: 28px; font-weight: 300;
  letter-spacing: 10px; color: var(--text);
  text-transform: uppercase; margin-bottom: 6px;
  text-shadow: 0 0 40px rgba(255,255,255,0.18);
}
.ld-wordmark em { color: var(--cyan); font-style: normal }
.ld-sub {
  font-family: 'DM Mono', monospace;
  font-size: 9px; letter-spacing: 5px;
  color: var(--text3); text-transform: uppercase; margin-bottom: 36px;
}
.ld-track { width: 200px; height: 1px; background: var(--border2); overflow: hidden }
.ld-fill {
  height: 100%; width: 0;
  background: linear-gradient(90deg, var(--border2), var(--cyan), var(--text));
  box-shadow: 0 0 10px var(--cyan-glow);
  animation: ldfill 2.4s cubic-bezier(.4,0,.2,1) forwards;
}
@keyframes ldfill { to { width: 100% } }
.ld-status {
  font-family: 'DM Mono', monospace; font-size: 8px;
  letter-spacing: 3px; color: var(--text3);
  margin-top: 14px; text-transform: uppercase;
  animation: blink 1.8s ease infinite;
}
@keyframes blink { 0%,100%{opacity:.3} 50%{opacity:1} }

/* ── HEADER ── */
#app { position: relative; z-index: 2; }

header {
  position: sticky; top: 0; z-index: 100;
  height: 60px;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 40px;
  background: rgba(2,5,8,0.95);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}
header::after {
  content: '';
  position: absolute; bottom: 0; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--cyan), var(--gold), transparent);
  opacity: 0.4;
}

.logo {
  display: flex; align-items: center; gap: 14px;
}
.logo-orb {
  width: 28px; height: 28px; border-radius: 50%;
  border: 1px solid rgba(0,212,255,0.25);
  display: flex; align-items: center; justify-content: center;
  position: relative;
  box-shadow: 0 0 16px var(--cyan-glow), inset 0 0 8px rgba(0,212,255,0.05);
  flex-shrink: 0;
}
.logo-orb::before {
  content: ''; position: absolute; inset: 6px; border-radius: 50%;
  border: 1px solid rgba(0,212,255,0.15);
}
.logo-dot {
  width: 6px; height: 6px; background: var(--text); border-radius: 50%;
  box-shadow: 0 0 10px var(--cyan), 0 0 20px var(--cyan-glow);
}
.logo-copy {}
.logo-main {
  font-family: 'Cormorant', serif;
  font-size: 17px; font-weight: 300;
  letter-spacing: 6px; color: var(--text);
  text-transform: uppercase; line-height: 1;
  text-shadow: 0 0 30px rgba(255,255,255,0.15);
}
.logo-main em { color: var(--cyan); font-style: normal; }
.logo-tag {
  font-family: 'DM Mono', monospace;
  font-size: 7px; letter-spacing: 3px;
  color: var(--text3); text-transform: uppercase; margin-top: 3px;
}

.header-right { display: flex; align-items: center; gap: 24px; }

.sys-status {
  display: flex; align-items: center; gap: 8px;
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 500; letter-spacing: 1.5px;
  color: var(--green); text-transform: uppercase;
}
.sys-dot {
  width: 6px; height: 6px;
  background: var(--green);
  border-radius: 50%;
  box-shadow: 0 0 6px var(--green);
  animation: pulse 2s infinite;
}
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(1.4)} }

.hdr-time {
  font-family: 'Inter', sans-serif;
  font-size: 13px; font-weight: 400; color: var(--text2);
  letter-spacing: 0.5px;
}
.hdr-corner {
  width: 10px; height: 10px;
  border-top: 1px solid var(--cyan);
  border-right: 1px solid var(--cyan);
  opacity: 0.5;
}

/* ── HERO SECTION ── */
.hero {
  padding: 48px 40px 40px;
  border-bottom: 1px solid var(--border);
  position: relative; overflow: hidden;
}
.hero-bg-text {
  position: absolute; right: -10px; bottom: -30px;
  font-family: 'Cormorant', serif;
  font-size: 220px; font-weight: 700;
  color: rgba(0,212,255,0.02);
  letter-spacing: -10px;
  pointer-events: none; line-height: 1;
  user-select: none;
}

.hero-top {
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 500; letter-spacing: 3px;
  color: var(--cyan); text-transform: uppercase;
  margin-bottom: 16px;
  display: flex; align-items: center; gap: 12px;
}
.hero-top::before { content:'//'; opacity:0.5; }

.hero-balance {
  font-family: 'Inter', sans-serif;
  font-size: clamp(48px, 7vw, 90px);
  font-weight: 700; line-height: 1;
  letter-spacing: -1px;
  color: var(--text);
  margin-bottom: 8px;
}
.hero-balance-label {
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 400; letter-spacing: 2px;
  color: var(--text3); text-transform: uppercase;
  margin-bottom: 32px;
}

.hero-stats {
  display: flex; gap: 0;
  flex-wrap: wrap;
}
.hero-stat {
  padding: 0 32px 0 0;
  border-right: 1px solid var(--border2);
  margin-right: 32px;
}
.hero-stat:last-child { border: none; }
.hs-label {
  font-family: 'Inter', sans-serif;
  font-size: 10px; font-weight: 500; letter-spacing: 1.5px;
  color: var(--text3); text-transform: uppercase;
  margin-bottom: 6px;
}
.hs-value {
  font-family: 'Inter', sans-serif;
  font-size: 24px; font-weight: 700;
  letter-spacing: -0.5px;
}
.hs-value.green { color: var(--green); text-shadow: 0 0 12px rgba(0,255,136,0.4); }
.hs-value.red   { color: var(--red);   text-shadow: 0 0 12px rgba(255,51,102,0.4); }
.hs-value.gold  { color: var(--gold);  text-shadow: 0 0 12px var(--gold-glow); }
.hs-value.cyan  { color: var(--cyan);  text-shadow: 0 0 12px var(--cyan-glow); }
.hs-value.dim   { color: var(--text2); font-size:16px; }

/* ── MAIN ── */
.main { max-width: 1400px; margin: 0 auto; padding: 36px 40px; }

.section-header {
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 20px;
}
.section-title {
  font-family: 'Inter', sans-serif;
  font-size: 10px; font-weight: 500; letter-spacing: 3px;
  color: var(--text3); text-transform: uppercase;
}
.section-line { flex: 1; height: 1px; background: var(--border); }
.section-num {
  font-family: 'DM Mono', monospace;
  font-size: 8px; color: var(--text3); letter-spacing: 1px;
}

/* ── EA CARDS GRID ── */
.ea-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-bottom: 48px;
}

.ea-card {
  background: var(--panel);
  border: 1px solid var(--border);
  position: relative; overflow: hidden;
  cursor: pointer;
  transition: border-color 0.3s, transform 0.3s, box-shadow 0.3s;
  clip-path: polygon(0 0, calc(100% - 16px) 0, 100% 16px, 100% 100%, 0 100%);
}
.ea-card::before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(0,212,255,0.04) 0%, transparent 60%);
  pointer-events: none;
  opacity: 0; transition: opacity 0.3s;
}
.ea-card:hover { transform: translateY(-4px); }
.ea-card:hover::before { opacity: 1; }

.ea-card.gold-card:hover { border-color: var(--gold); box-shadow: 0 0 30px rgba(240,180,41,0.15), 0 20px 40px rgba(0,0,0,0.5); }
.ea-card.cyan-card:hover { border-color: var(--cyan); box-shadow: 0 0 30px var(--cyan-dim), 0 20px 40px rgba(0,0,0,0.5); }
.ea-card.purple-card:hover { border-color: var(--purple); box-shadow: 0 0 30px rgba(139,92,246,0.15), 0 20px 40px rgba(0,0,0,0.5); }

/* Corner cut indicator */
.ea-card::after {
  content: '';
  position: absolute; top: 0; right: 0;
  width: 16px; height: 16px;
  border-left: 1px solid var(--border2);
  border-bottom: 1px solid var(--border2);
  pointer-events: none;
}

.card-accent-bar { height: 2px; width: 100%; }
.bar-gold   { background: linear-gradient(90deg, var(--gold), transparent); }
.bar-cyan   { background: linear-gradient(90deg, var(--cyan), transparent); }
.bar-purple { background: linear-gradient(90deg, var(--purple), transparent); }

.card-head {
  padding: 18px 20px 14px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: flex-start; justify-content: space-between;
}
.card-name {
  font-family: 'Inter', sans-serif;
  font-size: 20px; font-weight: 700;
  letter-spacing: -0.5px; margin-bottom: 3px;
}
.card-name.gold   { color: var(--gold); }
.card-name.cyan   { color: var(--cyan); }
.card-name.purple { color: var(--purple); }

.card-port {
  font-family: 'Inter', sans-serif;
  font-size: 10px; font-weight: 400; color: var(--text3);
  letter-spacing: 1px;
}
.card-live {
  display: flex; align-items: center; gap: 5px;
  font-family: 'Inter', sans-serif;
  font-size: 10px; font-weight: 500; letter-spacing: 1px;
  color: var(--green);
  background: var(--green-dim);
  border: 1px solid rgba(0,255,136,0.2);
  padding: 3px 8px;
}
.card-live-dot {
  width: 4px; height: 4px;
  background: var(--green); border-radius: 50%;
  box-shadow: 0 0 4px var(--green);
  animation: pulse 2s infinite;
}

.card-body { padding: 16px 20px; }

.card-profit-label {
  font-family: 'Inter', sans-serif;
  font-size: 10px; font-weight: 500; letter-spacing: 1.5px;
  color: var(--text3); text-transform: uppercase;
  margin-bottom: 4px;
}
.card-profit-value {
  font-family: 'Inter', sans-serif;
  font-size: 36px; font-weight: 700;
  letter-spacing: -1px; margin-bottom: 12px;
  line-height: 1;
}
.card-profit-value.green { color: var(--green); text-shadow: 0 0 16px rgba(0,255,136,0.35); }
.card-profit-value.red   { color: var(--red);   text-shadow: 0 0 16px rgba(255,51,102,0.35); }

/* Sparkline */
.spark-wrap { height: 44px; margin-bottom: 14px; position: relative; }
.spark-zero-line {
  position: absolute; left: 0; right: 0;
  height: 1px; background: var(--border2);
  top: 50%;
}

.card-metrics {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.metric {}
.metric-label {
  font-family: 'Inter', sans-serif;
  font-size: 10px; font-weight: 500; letter-spacing: 1px;
  color: var(--text3); text-transform: uppercase;
  margin-bottom: 3px;
}
.metric-value {
  font-family: 'Inter', sans-serif;
  font-size: 14px; font-weight: 600;
}
.metric-value.green { color: var(--green); }
.metric-value.red   { color: var(--red); }
.metric-value.gold  { color: var(--gold); }
.metric-value.cyan  { color: var(--cyan); }
.metric-value.dim   { color: var(--text2); }

.card-foot {
  padding: 10px 20px;
  border-top: 1px solid var(--border);
}
.btn-view {
  width: 100%;
  background: transparent;
  border: 1px solid var(--border2);
  color: var(--text2);
  padding: 8px;
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 500; letter-spacing: 1.5px;
  text-transform: uppercase; cursor: pointer;
  transition: all 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 8px;
}
.btn-view:hover { background: var(--surface); color: var(--text); border-color: var(--text2); }
.btn-view-arr { transition: transform 0.2s; }
.btn-view:hover .btn-view-arr { transform: translateX(4px); }

/* ── DETAIL PAGE ── */
#detail-page {
  display: none;
  position: fixed; inset: 0;
  background: var(--void);
  z-index: 200; overflow-y: auto;
}

.d-header {
  position: sticky; top: 0; z-index: 10;
  height: 60px;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 40px;
  background: rgba(2,5,8,0.97);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}
.btn-back {
  display: flex; align-items: center; gap: 8px;
  background: none; border: 1px solid var(--border2);
  color: var(--text2);
  padding: 7px 16px;
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 500; letter-spacing: 1.5px;
  text-transform: uppercase; cursor: pointer;
  transition: all 0.2s;
}
.btn-back:hover { border-color: var(--cyan); color: var(--cyan); }

.d-header-title {
  font-family: 'Inter', sans-serif;
  font-size: 12px; font-weight: 500; letter-spacing: 2px;
  color: var(--text2); text-transform: uppercase;
}

.d-content { max-width: 1100px; margin: 0 auto; padding: 40px; }

.d-hero {
  display: grid; grid-template-columns: 1fr auto;
  gap: 40px; align-items: start;
  padding-bottom: 32px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 28px;
}
.d-hero-left {}
.d-ea-name {
  font-family: 'Inter', sans-serif;
  font-size: 52px; font-weight: 700;
  letter-spacing: -1px; line-height: 1;
  margin-bottom: 6px;
}
.d-ea-name.gold   { color: var(--gold); text-shadow: 0 0 40px var(--gold-glow); }
.d-ea-name.cyan   { color: var(--cyan); text-shadow: 0 0 40px var(--cyan-glow); }
.d-ea-name.purple { color: var(--purple); text-shadow: 0 0 40px rgba(139,92,246,0.4); }
.d-ea-sub {
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 400; letter-spacing: 2px;
  color: var(--text3); text-transform: uppercase;
  margin-bottom: 24px;
}
.d-balance {
  font-family: 'Inter', sans-serif;
  font-size: 48px; font-weight: 700;
  color: var(--text); line-height: 1;
  letter-spacing: -1px;
}
.d-balance-sub {
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 400; color: var(--text3);
  letter-spacing: 1px; margin-top: 6px;
}
.d-balance-sub span { color: var(--text2); }

.d-hero-right {
  text-align: right;
}
.d-profit-big {
  font-family: 'Inter', sans-serif;
  font-size: 34px; font-weight: 700;
  line-height: 1; letter-spacing: -0.5px;
  margin-bottom: 4px;
}
.d-profit-big.green { color: var(--green); text-shadow: 0 0 20px rgba(0,255,136,0.4); }
.d-profit-big.red   { color: var(--red);   text-shadow: 0 0 20px rgba(255,51,102,0.4); }
.d-profit-label {
  font-family: 'Inter', sans-serif;
  font-size: 10px; font-weight: 500; letter-spacing: 1.5px;
  color: var(--text3); text-transform: uppercase;
}

/* Stats grid */
.d-stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1px; background: var(--border);
  margin-bottom: 24px;
}
.d-stat {
  background: var(--panel);
  padding: 16px 18px;
  position: relative; overflow: hidden;
}
.d-stat::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0;
  height: 1px;
}
.d-stat.accent-green::before { background: var(--green); box-shadow: 0 0 8px var(--green); }
.d-stat.accent-red::before   { background: var(--red);   box-shadow: 0 0 8px var(--red); }
.d-stat.accent-gold::before  { background: var(--gold);  box-shadow: 0 0 8px var(--gold); }
.d-stat.accent-cyan::before  { background: var(--cyan);  box-shadow: 0 0 8px var(--cyan); }

.ds-label {
  font-family: 'Inter', sans-serif;
  font-size: 10px; font-weight: 500; letter-spacing: 1.5px;
  color: var(--text3); text-transform: uppercase;
  margin-bottom: 8px;
}
.ds-value {
  font-family: 'Inter', sans-serif;
  font-size: 20px; font-weight: 700;
  line-height: 1;
}
.ds-value.green { color: var(--green); }
.ds-value.red   { color: var(--red); }
.ds-value.gold  { color: var(--gold); }
.ds-value.cyan  { color: var(--cyan); }
.ds-value.dim   { color: var(--text2); }

/* Chart panel */
.d-panel {
  background: var(--panel);
  border: 1px solid var(--border);
  margin-bottom: 20px;
  position: relative;
}
.d-panel-header {
  padding: 14px 20px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.d-panel-title {
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 500; letter-spacing: 2px;
  color: var(--text3); text-transform: uppercase;
  display: flex; align-items: center; gap: 8px;
}
.d-panel-title::before { content:'//'; color: var(--border2); }

.range-btns {
  display: flex; gap: 4px;
}
.range-btn {
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 500; letter-spacing: 1px;
  padding: 4px 10px;
  border: 1px solid var(--border2);
  background: transparent; color: var(--text3);
  cursor: pointer; transition: all 0.15s;
  text-transform: uppercase;
}
.range-btn:hover { border-color: var(--text2); color: var(--text2); }
.range-btn.active { border-color: var(--cyan); color: var(--cyan); background: var(--cyan-dim); }

.d-panel-body { padding: 20px; }
.chart-wrap { height: 280px; position: relative; }

/* PNL rows */
.pnl-table {}
.pnl-tr {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
  position: relative;
}
.pnl-tr:last-child { border: none; }
.pnl-tr::before {
  content: '';
  position: absolute; left: -20px; top: 0; bottom: 0;
  width: 2px; background: var(--border);
  transition: background 0.2s;
}
.pnl-td-label {
  font-family: 'Inter', sans-serif;
  font-size: 12px; font-weight: 500; letter-spacing: 1px;
  color: var(--text3); text-transform: uppercase;
  display: flex; align-items: center; gap: 8px;
}
.pnl-td-label::before { content: '►'; font-size: 6px; color: var(--border2); }
.pnl-td-value {
  font-family: 'Inter', sans-serif;
  font-size: 18px; font-weight: 700;
}
.pnl-td-value.green { color: var(--green); }
.pnl-td-value.red   { color: var(--red); }
.pnl-td-value.dim   { color: var(--text2); }

/* Footer */
.page-footer {
  font-family: 'Inter', sans-serif;
  font-size: 11px; font-weight: 400; color: var(--text3);
  letter-spacing: 0.5px; text-align: center;
  padding: 20px 0 0; line-height: 2.2;
}

/* ── RESPONSIVE ── */
@media(max-width: 900px) {
  .ea-grid { grid-template-columns: 1fr; }
  header, .hero, .main { padding-left: 20px; padding-right: 20px; }
  .d-header { padding: 0 20px; }
  .d-content { padding: 24px 20px; }
  .d-hero { grid-template-columns: 1fr; }
  .d-hero-right { text-align: left; }
  .d-stats-grid { grid-template-columns: repeat(2, 1fr); }
  .d-balance { font-size: 36px; }
}

/* ── CORNER DECORATIONS ── */
.corner-tl, .corner-tr, .corner-bl, .corner-br {
  position: absolute; width: 10px; height: 10px;
  pointer-events: none;
}
.corner-tl { top: 0; left: 0; border-top: 1px solid var(--cyan); border-left: 1px solid var(--cyan); opacity: 0.5; }
.corner-tr { top: 0; right: 0; border-top: 1px solid var(--cyan); border-right: 1px solid var(--cyan); opacity: 0.5; }
.corner-bl { bottom: 0; left: 0; border-bottom: 1px solid var(--cyan); border-left: 1px solid var(--cyan); opacity: 0.5; }
.corner-br { bottom: 0; right: 0; border-bottom: 1px solid var(--cyan); border-right: 1px solid var(--cyan); opacity: 0.5; }
</style>
</head>
<body>

<!-- ── LOADING ── -->
<canvas id="cv"></canvas>
<canvas id="ship-cv"></canvas>
<div class="neb neb-a"></div>
<div class="neb neb-b"></div>
<div id="loading">
  <div class="ld-orrery"><div class="ld-core"></div></div>
  <div class="ld-wordmark">Entry<em>Plan</em></div>
  <div class="ld-sub">Academy · Systems Online</div>
  <div class="ld-track"><div class="ld-fill"></div></div>
  <div class="ld-status">Calibrating data streams&hellip;</div>
</div>

<!-- ── APP ── -->
<div id="app">

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-orb"><div class="logo-dot"></div></div>
    <div class="logo-copy">
      <div class="logo-main">Entry<em>Plan</em></div>
      <div class="logo-tag">Academy · Observatory</div>
    </div>
  </div>
  <div class="header-right">
    <div class="sys-status"><div class="sys-dot"></div>ALL SYSTEMS ONLINE</div>
    <div class="hdr-time" id="live-clock">--:--:--</div>
    <div class="hdr-corner"></div>
  </div>
</header>

<!-- HOME PAGE -->
<div id="home-page">

  <!-- HERO -->
  <section class="hero">
    <div class="hero-bg-text">EPA</div>
    <div class="hero-top">COMBINED PORTFOLIO BALANCE</div>
    <div class="hero-balance" id="hero-total">$0.00</div>
    <div class="hero-balance-label">TOTAL ASSETS UNDER MANAGEMENT · 3 ACTIVE PORTFOLIOS</div>
    <div class="hero-stats">
      <div class="hero-stat">
        <div class="hs-label">Total Profit</div>
        <div class="hs-value green" id="h-total-pnl">+$0.00</div>
      </div>
      <div class="hero-stat">
        <div class="hs-label">Monthly Profit</div>
        <div class="hs-value green" id="h-monthly-pnl">+$0.00</div>
      </div>
      <div class="hero-stat">
        <div class="hs-label">Active EAs</div>
        <div class="hs-value gold">03</div>
      </div>
      <div class="hero-stat">
        <div class="hs-label">Last Sync</div>
        <div class="hs-value dim" id="h-update">—</div>
      </div>
    </div>
  </section>

  <!-- CARDS -->
  <div class="main">
    <div class="section-header">
      <div class="section-title">// Portfolio Nodes</div>
      <div class="section-line"></div>
      <div class="section-num">[ 3 / 3 ONLINE ]</div>
    </div>

    <div class="ea-grid">

      <!-- GRADE A -->
      <div class="ea-card gold-card" onclick="openDetail('gradea')">
        <div class="corner-tl"></div>
        <div class="card-accent-bar bar-gold"></div>
        <div class="card-head">
          <div>
            <div class="card-name gold">GRADE A</div>
            <div class="card-port">PORT #501412 // XAUUSD</div>
          </div>
          <div class="card-live"><div class="card-live-dot"></div>LIVE</div>
        </div>
        <div class="card-body">
          <div class="card-profit-label">// TOTAL PROFIT</div>
          <div class="card-profit-value green" id="ga-total-pnl">—</div>
          <div class="spark-wrap">
            <div class="spark-zero-line"></div>
            <canvas id="spark-gradea"></canvas>
          </div>
          <div class="card-metrics">
            <div class="metric">
              <div class="metric-label">Monthly Profit</div>
              <div class="metric-value green" id="ga-month-pnl">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Win Rate</div>
              <div class="metric-value gold" id="ga-winrate">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Balance</div>
              <div class="metric-value dim" id="ga-balance">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Growth</div>
              <div class="metric-value gold" id="ga-growth">—</div>
            </div>
          </div>
        </div>
        <div class="card-foot">
          <button class="btn-view">ACCESS NODE <span class="btn-view-arr">→</span></button>
        </div>
      </div>

      <!-- BLACKHOLE -->
      <div class="ea-card cyan-card" onclick="openDetail('blackhole')">
        <div class="corner-tl"></div>
        <div class="card-accent-bar bar-cyan"></div>
        <div class="card-head">
          <div>
            <div class="card-name cyan">BLACKHOLE</div>
            <div class="card-port">PORT #501425 // XAUUSD</div>
          </div>
          <div class="card-live"><div class="card-live-dot"></div>LIVE</div>
        </div>
        <div class="card-body">
          <div class="card-profit-label">// TOTAL PROFIT</div>
          <div class="card-profit-value green" id="bh-total-pnl">—</div>
          <div class="spark-wrap">
            <div class="spark-zero-line"></div>
            <canvas id="spark-blackhole"></canvas>
          </div>
          <div class="card-metrics">
            <div class="metric">
              <div class="metric-label">Monthly Profit</div>
              <div class="metric-value green" id="bh-month-pnl">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Win Rate</div>
              <div class="metric-value gold" id="bh-winrate">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Balance</div>
              <div class="metric-value dim" id="bh-balance">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Growth</div>
              <div class="metric-value gold" id="bh-growth">—</div>
            </div>
          </div>
        </div>
        <div class="card-foot">
          <button class="btn-view">ACCESS NODE <span class="btn-view-arr">→</span></button>
        </div>
      </div>

      <!-- BIGBANG -->
      <div class="ea-card purple-card" onclick="openDetail('bigbang')">
        <div class="corner-tl"></div>
        <div class="card-accent-bar bar-purple"></div>
        <div class="card-head">
          <div>
            <div class="card-name purple">BIGBANG</div>
            <div class="card-port">PORT #501427 // XAUUSD</div>
          </div>
          <div class="card-live"><div class="card-live-dot"></div>LIVE</div>
        </div>
        <div class="card-body">
          <div class="card-profit-label">// TOTAL PROFIT</div>
          <div class="card-profit-value green" id="bb-total-pnl">—</div>
          <div class="spark-wrap">
            <div class="spark-zero-line"></div>
            <canvas id="spark-bigbang"></canvas>
          </div>
          <div class="card-metrics">
            <div class="metric">
              <div class="metric-label">Monthly Profit</div>
              <div class="metric-value green" id="bb-month-pnl">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Win Rate</div>
              <div class="metric-value gold" id="bb-winrate">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Balance</div>
              <div class="metric-value dim" id="bb-balance">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Growth</div>
              <div class="metric-value gold" id="bb-growth">—</div>
            </div>
          </div>
        </div>
        <div class="card-foot">
          <button class="btn-view">ACCESS NODE <span class="btn-view-arr">→</span></button>
        </div>
      </div>

    </div><!-- ea-grid -->

    <div class="page-footer">
      PAST PERFORMANCE IS NOT INDICATIVE OF FUTURE RESULTS // TRADING INVOLVES SUBSTANTIAL RISK<br>
      © 2025 ENTRYPLAN ACADEMY // ALL RIGHTS RESERVED
    </div>
  </div>
</div><!-- home-page -->

<!-- ── DETAIL PAGE ── -->
<div id="detail-page">
  <div class="d-header">
    <button class="btn-back" onclick="closeDetail()">◄ BACK</button>
    <div class="d-header-title" id="d-header-label">—</div>
    <div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--text3);letter-spacing:2px" id="d-port-label">—</div>
  </div>

  <div class="d-content">

    <!-- D HERO -->
    <div class="d-hero">
      <div class="d-hero-left">
        <div class="d-ea-name gold" id="d-name">—</div>
        <div class="d-ea-sub" id="d-sub">—</div>
        <div class="d-balance" id="d-balance">$0.00</div>
        <div class="d-balance-sub">
          EQUITY: <span id="d-equity">—</span> &nbsp;//&nbsp; FLOATING P&amp;L: <span id="d-floating">—</span>
        </div>
      </div>
      <div class="d-hero-right">
        <div class="d-profit-label">// TOTAL PROFIT</div>
        <div class="d-profit-big green" id="d-profit-big">—</div>
      </div>
    </div>

    <!-- STATS GRID -->
    <div class="d-stats-grid" style="margin-bottom:24px">
      <div class="d-stat accent-green">
        <div class="ds-label">Total Profit</div>
        <div class="ds-value green" id="d-total-pnl">—</div>
      </div>
      <div class="d-stat accent-green">
        <div class="ds-label">Monthly Profit</div>
        <div class="ds-value green" id="d-month-pnl">—</div>
      </div>
      <div class="d-stat accent-cyan">
        <div class="ds-label">Daily Profit</div>
        <div class="ds-value cyan" id="d-daily-pnl">—</div>
      </div>
      <div class="d-stat accent-gold">
        <div class="ds-label">Growth</div>
        <div class="ds-value gold" id="d-growth">—</div>
      </div>
      <div class="d-stat accent-gold">
        <div class="ds-label">Win Rate</div>
        <div class="ds-value gold" id="d-winrate">—</div>
      </div>
      <div class="d-stat accent-cyan">
        <div class="ds-label">Profit Factor</div>
        <div class="ds-value cyan" id="d-pf">—</div>
      </div>
      <div class="d-stat accent-red">
        <div class="ds-label">Max Drawdown</div>
        <div class="ds-value red" id="d-dd">—</div>
      </div>
      <div class="d-stat accent-gold">
        <div class="ds-label">Open Orders</div>
        <div class="ds-value gold" id="d-open">—</div>
      </div>
    </div>

    <!-- PROFIT CURVE -->
    <div class="d-panel">
      <div class="d-panel-header">
        <div class="d-panel-title">PROFIT CURVE</div>
        <div class="range-btns">
          <button class="range-btn active" id="r-all" onclick="setRange('all')">ALL</button>
          <button class="range-btn" id="r-3m" onclick="setRange('3m')">3M</button>
          <button class="range-btn" id="r-1m" onclick="setRange('1m')">1M</button>
          <button class="range-btn" id="r-1w" onclick="setRange('1w')">1W</button>
        </div>
      </div>
      <div class="d-panel-body">
        <div class="chart-wrap"><canvas id="detailChart"></canvas></div>
      </div>
    </div>

    <!-- PNL SUMMARY -->
    <div class="d-panel">
      <div class="d-panel-header">
        <div class="d-panel-title">P&amp;L BREAKDOWN</div>
      </div>
      <div class="d-panel-body">
        <div class="pnl-table">
          <div class="pnl-tr">
            <div class="pnl-td-label">Daily Profit</div>
            <div class="pnl-td-value green" id="dp-daily">—</div>
          </div>
          <div class="pnl-tr">
            <div class="pnl-td-label">Monthly Profit</div>
            <div class="pnl-td-value green" id="dp-month">—</div>
          </div>
          <div class="pnl-tr">
            <div class="pnl-td-label">Total Profit (All Time)</div>
            <div class="pnl-td-value green" id="dp-total">—</div>
          </div>
          <div class="pnl-tr">
            <div class="pnl-td-label">Total Trades</div>
            <div class="pnl-td-value dim" id="dp-trades">—</div>
          </div>
          <div class="pnl-tr">
            <div class="pnl-td-label">Win / Lose Split</div>
            <div class="pnl-td-value dim" id="dp-winlose">—</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div><!-- detail-page -->

</div><!-- app -->

<script>
// ── CONFIG ──
const SUPA_URL = 'https://stdvqepkkkeehojstfww.supabase.co';
const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN0ZHZxZXBra2tlZWhvanN0Znd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyNTE5MjMsImV4cCI6MjA4NzgyNzkyM30.g25XS-O44n-Nf01-pRKy3pBH4OpYwQ7nbia67vHtx04';

const EA_CONFIG = {
  gradea:   { name:'GRADE A',   port:'501412', prefix:'ga', color:'#f0b429', nameClass:'gold'   },
  blackhole:{ name:'BLACKHOLE', port:'501425', prefix:'bh', color:'#00d4ff', nameClass:'cyan'   },
  bigbang:  { name:'BIGBANG',   port:'501427', prefix:'bb', color:'#8b5cf6', nameClass:'purple' },
};

let allData={}, allEquity={}, detailChart=null, currentEA=null, currentRange='all', sparkCharts={};

// ── CLOCK ──
function updateClock(){
  const now = new Date();
  document.getElementById('live-clock').textContent =
    now.toLocaleTimeString('en-GB',{hour12:false}) + ' UTC+7';
}
setInterval(updateClock, 1000);
updateClock();

// ── FETCH ──
async function fetchSupa(table, query=''){
  try{
    const r = await fetch(`${SUPA_URL}/rest/v1/${table}?${query}`,{
      headers:{'apikey':SUPA_KEY,'Authorization':`Bearer ${SUPA_KEY}`}
    });
    return r.ok ? r.json() : [];
  }catch(e){ return []; }
}

// ── FORMAT ──
function fUSD(v){
  if(v===null||v===undefined)return'—';
  const s=v>=0?'+':'-';
  return`${s}$${Math.abs(v).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}`;
}
function fBal(v){ return '$'+parseFloat(v||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function fPct(v){ return (v>=0?'+':'')+parseFloat(v||0).toFixed(2)+'%'; }
function cls(v){ return parseFloat(v||0)>=0?'green':'red'; }

// ── SPARKLINE ──
function buildSparkline(id, eq, color){
  if(sparkCharts[id]) sparkCharts[id].destroy();
  const ctx = document.getElementById(id);
  if(!ctx||!eq||eq.length<2) return;
  const vals = eq.map(d=>parseFloat(d.profit||0));
  const g = ctx.getContext('2d').createLinearGradient(0,0,0,44);
  g.addColorStop(0, color+'50'); g.addColorStop(1, color+'00');
  sparkCharts[id] = new Chart(ctx,{
    type:'line',
    data:{ labels:vals.map((_,i)=>i), datasets:[{
      data:vals, borderColor:color, backgroundColor:g,
      borderWidth:1.5, pointRadius:0, fill:true, tension:0.4
    }]},
    options:{ responsive:true, maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{enabled:false}},
      scales:{x:{display:false},y:{display:false}},
      animation:{duration:1000}
    }
  });
}

// ── RENDER CARD ──
function renderCard(key, stats, eq){
  const p = EA_CONFIG[key].prefix;
  const d = stats&&stats.length>0 ? stats[0] : null;
  if(!d) return;

  const tEl = document.getElementById(`${p}-total-pnl`);
  tEl.textContent = fUSD(d.total_pnl||0);
  tEl.className = `card-profit-value ${cls(d.total_pnl||0)}`;

  const mEl = document.getElementById(`${p}-month-pnl`);
  mEl.textContent = fUSD(d.monthly_pnl||0);
  mEl.className = `metric-value ${cls(d.monthly_pnl||0)}`;

  document.getElementById(`${p}-winrate`).textContent = (d.win_rate||0).toFixed(1)+'%';
  document.getElementById(`${p}-balance`).textContent = fBal(d.balance);

  const gEl = document.getElementById(`${p}-growth`);
  gEl.textContent = fPct(d.growth_percent||0);
  gEl.className = `metric-value ${(d.growth_percent||0)>=0?'gold':'red'}`;

  buildSparkline(`spark-${key}`, eq, EA_CONFIG[key].color);
}

// ── RENDER HERO ──
function renderHero(){
  let tb=0, tp=0, tm=0, lt=null;
  Object.keys(allData).forEach(k=>{
    const d = allData[k]&&allData[k].length>0 ? allData[k][0] : null;
    if(!d) return;
    tb += parseFloat(d.balance||0);
    tp += parseFloat(d.total_pnl||0);
    tm += parseFloat(d.monthly_pnl||0);
    if(!lt||new Date(d.recorded_at)>new Date(lt)) lt=d.recorded_at;
  });

  document.getElementById('hero-total').textContent = fBal(tb);

  const tEl=document.getElementById('h-total-pnl');
  tEl.textContent=fUSD(tp); tEl.className='hs-value '+(tp>=0?'green':'red');

  const mEl=document.getElementById('h-monthly-pnl');
  mEl.textContent=fUSD(tm); mEl.className='hs-value '+(tm>=0?'green':'red');

  if(lt){
    const dt=new Date(lt);
    document.getElementById('h-update').textContent =
      dt.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'})+' '+
      dt.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
  }
}

// ── OPEN DETAIL ──
function openDetail(key){
  currentEA=key; currentRange='all';
  const cfg = EA_CONFIG[key];
  const d = allData[key]&&allData[key].length>0 ? allData[key][0] : null;
  const eq = allEquity[key]||[];

  document.getElementById('d-header-label').textContent = cfg.name+' // NODE DETAILS';
  document.getElementById('d-port-label').textContent = 'PORT #'+cfg.port;
  document.getElementById('d-name').textContent = cfg.name;
  document.getElementById('d-name').className = 'd-ea-name '+cfg.nameClass;
  document.getElementById('d-sub').textContent = 'PORT #'+cfg.port+' // XAUUSD // LIVE';

  if(d){
    document.getElementById('d-balance').textContent = fBal(d.balance);
    document.getElementById('d-equity').textContent  = fBal(d.equity);

    const fEl=document.getElementById('d-floating');
    fEl.textContent=fUSD(d.floating_pnl||0);
    fEl.style.color=(d.floating_pnl||0)>=0?'var(--green)':'var(--red)';

    const bigProfit = document.getElementById('d-profit-big');
    bigProfit.textContent = fUSD(d.total_pnl||0);
    bigProfit.className = 'd-profit-big '+(d.total_pnl>=0?'green':'red');

    const set=(id,val,cls)=>{ const el=document.getElementById(id); el.textContent=val; if(cls)el.className='ds-value '+cls; };
    set('d-total-pnl', fUSD(d.total_pnl||0),  d.total_pnl>=0?'green':'red');
    set('d-month-pnl', fUSD(d.monthly_pnl||0), d.monthly_pnl>=0?'green':'red');
    set('d-daily-pnl', fUSD(d.daily_pnl||0),   d.daily_pnl>=0?'cyan':'red');
    set('d-growth',    fPct(d.growth_percent||0), d.growth_percent>=0?'gold':'red');
    set('d-winrate',   (d.win_rate||0).toFixed(1)+'%', 'gold');
    set('d-pf',        (d.profit_factor||0).toFixed(2), 'cyan');
    set('d-dd',        (d.drawdown_percent||0).toFixed(2)+'%', 'red');
    set('d-open',      d.open_orders||0, 'gold');

    const pnlSet=(id,val)=>{ const el=document.getElementById(id); el.textContent=fUSD(val); el.className='pnl-td-value '+(val>=0?'green':'red'); };
    pnlSet('dp-daily',  d.daily_pnl||0);
    pnlSet('dp-month',  d.monthly_pnl||0);
    pnlSet('dp-total',  d.total_pnl||0);
    document.getElementById('dp-trades').textContent = d.total_trades||0;
    document.getElementById('dp-winlose').textContent = `${d.winning_trades||0} W / ${d.losing_trades||0} L`;
  }

  // Range buttons reset
  ['all','3m','1m','1w'].forEach(r=>{
    document.getElementById('r-'+r).className = r==='all'?'range-btn active':'range-btn';
  });

  buildDetailChart(eq, cfg.color);
  document.getElementById('home-page').style.display = 'none';
  document.getElementById('detail-page').style.display = 'block';
  window.scrollTo(0,0);
}

function closeDetail(){
  document.getElementById('detail-page').style.display = 'none';
  document.getElementById('home-page').style.display   = 'block';
  if(detailChart){ detailChart.destroy(); detailChart=null; }
}

// ── DETAIL CHART ──
function buildDetailChart(eq, color){
  if(detailChart){ detailChart.destroy(); detailChart=null; }
  const f = filterRange(eq, currentRange);
  if(!f||f.length<2) return;

  const labels = f.map(d=>{
    const dt=new Date(d.recorded_at);
    return dt.toLocaleDateString('en-GB',{day:'2-digit',month:'short'});
  });
  const profitV = f.map(d=>parseFloat(d.profit||0));
  const ctx = document.getElementById('detailChart').getContext('2d');

  // Gradient fill
  const g = ctx.createLinearGradient(0,0,0,280);
  g.addColorStop(0, color+'55'); g.addColorStop(1, color+'00');

  // Zero baseline
  const zeroColor = 'rgba(90,122,142,0.3)';

  detailChart = new Chart(ctx,{
    type:'line',
    data:{
      labels,
      datasets:[{
        label:'Profit ($)',
        data:profitV,
        borderColor:color,
        backgroundColor:g,
        borderWidth:2,
        pointRadius: f.length>60 ? 0 : 3,
        pointBackgroundColor:color,
        pointBorderColor: 'var(--void)',
        pointBorderWidth:1,
        fill:true,
        tension:0.4,
      }]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      interaction:{intersect:false, mode:'index'},
      plugins:{
        legend:{display:false},
        tooltip:{
          backgroundColor:'#060c12',
          borderColor: color+'80',
          borderWidth:1,
          titleColor:'#5a7a8e',
          bodyColor:'#c8dce8',
          titleFont:{family:'DM Mono',size:9},
          bodyFont:{family:'DM Mono',size:11},
          padding:12,
          callbacks:{
            label:c=>`PROFIT: ${c.parsed.y>=0?'+':''}$${c.parsed.y.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}`
          }
        }
      },
      scales:{
        x:{
          grid:{color:'rgba(15,32,48,0.8)', borderColor:'transparent'},
          ticks:{color:'#2a4458', font:{family:'DM Mono',size:8}, maxTicksLimit:10}
        },
        y:{
          grid:{color:'rgba(15,32,48,0.8)', borderColor:'transparent'},
          ticks:{
            color:'#2a4458',
            font:{family:'DM Mono',size:8},
            callback: v=>(v>=0?'+$':'-$')+Math.abs(v).toLocaleString('en-US',{minimumFractionDigits:0})
          }
        }
      }
    }
  });
}

function filterRange(data, range){
  if(range==='all'||!data) return data;
  const now=new Date(), cut=new Date();
  if(range==='1w') cut.setDate(now.getDate()-7);
  if(range==='1m') cut.setMonth(now.getMonth()-1);
  if(range==='3m') cut.setMonth(now.getMonth()-3);
  return data.filter(d=>new Date(d.recorded_at)>=cut);
}

function setRange(r){
  currentRange=r;
  ['all','3m','1m','1w'].forEach(x=>{
    document.getElementById('r-'+x).className = x===r?'range-btn active':'range-btn';
  });
  if(currentEA) buildDetailChart(allEquity[currentEA], EA_CONFIG[currentEA].color);
}

// ── INIT ──
async function init(){
  await Promise.all(Object.keys(EA_CONFIG).map(async key=>{
    const [stats, equity] = await Promise.all([
      fetchSupa(`${key}_daily_stats`,  'order=recorded_at.desc&limit=1'),
      fetchSupa(`${key}_equity_curve`, 'order=recorded_at.asc&limit=730')
    ]);
    allData[key]   = stats;
    allEquity[key] = equity;
    renderCard(key, stats, equity);
  }));
  renderHero();

  setTimeout(()=>{
    const o = document.getElementById('loading');
    o.style.opacity='0';
    setTimeout(()=>o.style.display='none', 1400);
  }, 2800);
}

// ── STARFIELD ──
(function(){
  const cv=document.getElementById('cv');
  const cx=cv.getContext('2d');
  let W,H,stars=[];

  const LAYERS=[
    {f:.30,r:[.25,.50],s:[.003,.008],a:[.10,.32],gold:.015},
    {f:.45,r:[.40,.85],s:[.010,.022],a:[.20,.58],gold:.025},
    {f:.25,r:[.70,1.50],s:[.026,.048],a:[.38,.88],gold:.010},
  ];

  function mk(){
    W=cv.width=innerWidth; H=cv.height=innerHeight; stars=[];
    LAYERS.forEach(L=>{
      const n=Math.round(W*H/3000*L.f*3);
      for(let i=0;i<n;i++) stars.push({
        x:Math.random()*W, y:Math.random()*H,
        r:L.r[0]+Math.random()*(L.r[1]-L.r[0]),
        a:L.a[0]+Math.random()*(L.a[1]-L.a[0]),
        sy:(L.s[0]+Math.random()*(L.s[1]-L.s[0]))*(.7+Math.random()*.6),
        tw:.002+Math.random()*.006, ph:Math.random()*Math.PI*2,
        warm:Math.random()<L.gold,
      });
    });
  }

  let shots=[];
  function mayShoot(){
    if(Math.random()<.003) shots.push({
      x:Math.random()*W*.75,y:Math.random()*H*.35,
      vx:7+Math.random()*9,vy:1.5+Math.random()*3.5,a:.9,life:1,
    });
  }

  function frame(){
    cx.clearRect(0,0,W,H);
    stars.forEach(s=>{
      s.ph+=s.tw;
      const t=.5+.5*Math.sin(s.ph);
      const a=s.a*(.55+.45*t);
      cx.beginPath(); cx.arc(s.x,s.y,s.r,0,Math.PI*2);
      cx.fillStyle=s.warm?`rgba(210,225,255,${a})`:`rgba(170,205,255,${a})`;
      cx.fill();
      s.y+=s.sy;
      if(s.y>H+2){s.y=-2;s.x=Math.random()*W;}
    });
    mayShoot();
    shots=shots.filter(s=>s.life>0);
    shots.forEach(s=>{
      cx.save(); cx.globalAlpha=s.a*s.life;
      const g=cx.createLinearGradient(s.x,s.y,s.x-s.vx*4,s.y-s.vy*4);
      g.addColorStop(0,'rgba(200,225,255,.95)'); g.addColorStop(1,'transparent');
      cx.strokeStyle=g; cx.lineWidth=1.2;
      cx.beginPath(); cx.moveTo(s.x,s.y); cx.lineTo(s.x-s.vx*4,s.y-s.vy*4);
      cx.stroke(); cx.restore();
      s.x+=s.vx; s.y+=s.vy; s.life-=.022;
    });
    requestAnimationFrame(frame);
  }
  mk(); frame(); addEventListener('resize',mk);
})();

// ── SPACECRAFT ──
(function(){
  const cv = document.getElementById('ship-cv');
  const cx = cv.getContext('2d');
  let W, H;

  function resize(){ W = cv.width = innerWidth; H = cv.height = innerHeight; }
  resize(); addEventListener('resize', resize);

  // Ship definitions — each has a path-drawing function, scale, speed, depth
  const SHIPS = [];

  // Draw stealth bomber / triangular recon ship
  function drawStealthBomber(cx, scale, alpha, enginePulse) {
    cx.save();
    cx.globalAlpha = alpha;
    const s = scale;

    // Main hull — dark metallic body
    cx.beginPath();
    cx.moveTo(0, -38*s);          // nose
    cx.lineTo(-22*s, 8*s);        // left wing tip
    cx.lineTo(-14*s, 12*s);
    cx.lineTo(-8*s, 6*s);         // left engine nacelle back
    cx.lineTo(0, 18*s);           // center tail
    cx.lineTo(8*s, 6*s);
    cx.lineTo(14*s, 12*s);
    cx.lineTo(22*s, 8*s);         // right wing tip
    cx.closePath();

    const hullGrad = cx.createLinearGradient(0, -38*s, 0, 18*s);
    hullGrad.addColorStop(0,   'rgba(180,200,220,0.82)');
    hullGrad.addColorStop(0.3, 'rgba(100,130,160,0.75)');
    hullGrad.addColorStop(1,   'rgba(30,50,80,0.65)');
    cx.fillStyle = hullGrad;
    cx.fill();

    // Hull edge highlight
    cx.strokeStyle = 'rgba(140,200,255,0.35)';
    cx.lineWidth = 0.7*s;
    cx.stroke();

    // Cockpit / sensor pod
    cx.beginPath();
    cx.ellipse(0, -18*s, 4*s, 9*s, 0, 0, Math.PI*2);
    const cockpitG = cx.createRadialGradient(0, -20*s, 1*s, 0, -18*s, 6*s);
    cockpitG.addColorStop(0, 'rgba(150,230,255,0.9)');
    cockpitG.addColorStop(1, 'rgba(20,60,120,0.5)');
    cx.fillStyle = cockpitG;
    cx.fill();

    // Center spine line
    cx.beginPath();
    cx.moveTo(0, -36*s); cx.lineTo(0, 16*s);
    cx.strokeStyle = 'rgba(180,220,255,0.25)';
    cx.lineWidth = 1.2*s;
    cx.stroke();

    // Panel detail lines on wings
    cx.strokeStyle = 'rgba(120,180,220,0.18)';
    cx.lineWidth = 0.5*s;
    cx.beginPath(); cx.moveTo(-5*s,-10*s); cx.lineTo(-18*s,7*s); cx.stroke();
    cx.beginPath(); cx.moveTo(5*s,-10*s);  cx.lineTo(18*s,7*s);  cx.stroke();
    cx.beginPath(); cx.moveTo(-8*s,0); cx.lineTo(-14*s,10*s); cx.stroke();
    cx.beginPath(); cx.moveTo(8*s,0);  cx.lineTo(14*s,10*s);  cx.stroke();

    // Left engine glow
    const ep = 0.5 + 0.5 * enginePulse;
    const eg1 = cx.createRadialGradient(-8*s, 10*s, 0, -8*s, 10*s, 7*s);
    eg1.addColorStop(0, `rgba(80,180,255,${0.9*ep})`);
    eg1.addColorStop(0.4, `rgba(40,120,255,${0.5*ep})`);
    eg1.addColorStop(1, 'transparent');
    cx.fillStyle = eg1;
    cx.beginPath(); cx.arc(-8*s, 10*s, 7*s, 0, Math.PI*2); cx.fill();

    // Right engine glow
    const eg2 = cx.createRadialGradient(8*s, 10*s, 0, 8*s, 10*s, 7*s);
    eg2.addColorStop(0, `rgba(80,180,255,${0.9*ep})`);
    eg2.addColorStop(0.4, `rgba(40,120,255,${0.5*ep})`);
    eg2.addColorStop(1, 'transparent');
    cx.fillStyle = eg2;
    cx.beginPath(); cx.arc(8*s, 10*s, 7*s, 0, Math.PI*2); cx.fill();

    // Engine nozzle core bright dot
    cx.fillStyle = `rgba(200,240,255,${0.95*ep})`;
    cx.beginPath(); cx.arc(-8*s, 10*s, 1.8*s, 0, Math.PI*2); cx.fill();
    cx.beginPath(); cx.arc(8*s, 10*s, 1.8*s, 0, Math.PI*2); cx.fill();

    cx.restore();
  }

  // Draw elongated deep-space cruiser
  function drawCruiser(cx, scale, alpha, enginePulse) {
    cx.save();
    cx.globalAlpha = alpha;
    const s = scale;

    // Main elongated hull
    cx.beginPath();
    cx.moveTo(0, -52*s);           // nose tip
    cx.lineTo(-5*s, -30*s);
    cx.lineTo(-14*s, -10*s);
    cx.lineTo(-18*s, 14*s);
    cx.lineTo(-10*s, 26*s);
    cx.lineTo(10*s, 26*s);
    cx.lineTo(18*s, 14*s);
    cx.lineTo(14*s, -10*s);
    cx.lineTo(5*s, -30*s);
    cx.closePath();

    const hullG = cx.createLinearGradient(-18*s, 0, 18*s, 0);
    hullG.addColorStop(0,   'rgba(60,90,130,0.7)');
    hullG.addColorStop(0.5, 'rgba(160,190,220,0.82)');
    hullG.addColorStop(1,   'rgba(60,90,130,0.7)');
    cx.fillStyle = hullG;
    cx.fill();
    cx.strokeStyle = 'rgba(140,200,255,0.4)';
    cx.lineWidth = 0.8*s;
    cx.stroke();

    // Sensor array (front)
    cx.fillStyle = 'rgba(100,200,255,0.6)';
    cx.beginPath(); cx.ellipse(0, -45*s, 2*s, 5*s, 0, 0, Math.PI*2); cx.fill();

    // Bridge windows
    for(let i=-1;i<=1;i++){
      cx.fillStyle = `rgba(180,230,255,0.7)`;
      cx.beginPath(); cx.ellipse(i*5*s, -22*s, 1.5*s, 2.5*s, 0, 0, Math.PI*2); cx.fill();
    }

    // Side thruster pods
    cx.fillStyle = 'rgba(80,110,160,0.8)';
    cx.beginPath(); cx.roundRect(-22*s, 0, 6*s, 14*s, 2*s); cx.fill();
    cx.beginPath(); cx.roundRect(16*s, 0, 6*s, 14*s, 2*s); cx.fill();
    cx.strokeStyle = 'rgba(120,180,255,0.3)';
    cx.lineWidth = 0.5*s;
    cx.stroke();

    // Panel details
    cx.strokeStyle = 'rgba(150,200,240,0.15)';
    cx.lineWidth = 0.5*s;
    for(let y=-8;y<=20;y+=8){
      cx.beginPath(); cx.moveTo(-13*s,y*s); cx.lineTo(13*s,y*s); cx.stroke();
    }

    // Engine exhaust — 3 nozzles
    const ep = 0.5 + 0.5 * enginePulse;
    [-8,0,8].forEach(ox=>{
      const eg = cx.createRadialGradient(ox*s, 30*s, 0, ox*s, 30*s, 10*s);
      eg.addColorStop(0, `rgba(100,200,255,${ep})`);
      eg.addColorStop(0.3, `rgba(60,140,255,${0.6*ep})`);
      eg.addColorStop(1, 'transparent');
      cx.fillStyle = eg;
      cx.beginPath(); cx.arc(ox*s, 30*s, 10*s, 0, Math.PI*2); cx.fill();
      cx.fillStyle = `rgba(220,245,255,${ep})`;
      cx.beginPath(); cx.arc(ox*s, 28*s, 2*s, 0, Math.PI*2); cx.fill();
    });

    cx.restore();
  }

  // Trail particle system
  const particles = [];
  function spawnTrail(x, y, vx, vy, color) {
    for(let i=0;i<2;i++){
      particles.push({
        x: x + (Math.random()-0.5)*6,
        y: y + (Math.random()-0.5)*4,
        vx: vx * (0.1 + Math.random()*0.15) + (Math.random()-0.5)*0.3,
        vy: vy * (0.1 + Math.random()*0.15) + (Math.random()-0.5)*0.3,
        life: 1,
        decay: 0.012 + Math.random()*0.018,
        r: 1.5 + Math.random()*2.5,
        color,
      });
    }
  }

  // Spawn ships periodically
  function spawnShip() {
    const fromLeft = Math.random() > 0.5;
    const type = Math.random() > 0.45 ? 'stealth' : 'cruiser';
    const scale = 0.55 + Math.random() * 0.45;
    const speed = (0.28 + Math.random() * 0.35) * (type === 'stealth' ? 1.3 : 1);
    const y = H * (0.08 + Math.random() * 0.55);
    const angle = (fromLeft ? 0 : Math.PI) + (Math.random()-0.5)*0.18;
    const vx = Math.cos(angle) * speed;
    const vy = Math.sin(angle) * speed;
    // alpha based on scale (smaller = farther = more transparent)
    const alpha = 0.18 + scale * 0.5;

    SHIPS.push({
      x: fromLeft ? -120 : W + 120,
      y,
      vx, vy,
      angle,
      type,
      scale,
      alpha,
      speed,
      enginePhase: Math.random() * Math.PI * 2,
      trailColor: type === 'stealth' ? 'rgba(80,180,255,' : 'rgba(100,200,255,',
    });
  }

  // Initial ships
  for(let i=0;i<2;i++){
    setTimeout(()=>spawnShip(), i * 8000 + 2000);
  }
  setInterval(()=>{
    if(SHIPS.length < 2) spawnShip();
  }, 14000);

  let t = 0;
  function frame(){
    cx.clearRect(0, 0, W, H);
    t += 0.016;

    // Draw + update particles
    particles.forEach(p=>{
      p.x += p.vx; p.y += p.vy;
      p.life -= p.decay;
      if(p.life <= 0) return;
      cx.beginPath();
      cx.arc(p.x, p.y, p.r * p.life, 0, Math.PI*2);
      cx.fillStyle = p.color + (p.life * 0.55) + ')';
      cx.fill();
    });
    // Cull dead particles
    for(let i=particles.length-1;i>=0;i--){
      if(particles[i].life<=0) particles.splice(i,1);
    }

    // Draw + update ships
    for(let i=SHIPS.length-1;i>=0;i--){
      const ship = SHIPS[i];
      ship.x += ship.vx;
      ship.y += ship.vy;
      ship.enginePhase += 0.05;

      // Spawn trail from engine position (behind ship)
      const trailX = ship.x - Math.cos(ship.angle) * 18 * ship.scale;
      const trailY = ship.y - Math.sin(ship.angle) * 18 * ship.scale;
      spawnTrail(trailX, trailY, -ship.vx, -ship.vy, ship.trailColor);

      // Draw ship
      cx.save();
      cx.translate(ship.x, ship.y);
      // Rotate: ships point in direction of travel
      cx.rotate(ship.angle + Math.PI/2);

      const ep = Math.sin(ship.enginePhase);
      if(ship.type === 'stealth') drawStealthBomber(cx, ship.scale, ship.alpha, ep);
      else drawCruiser(cx, ship.scale, ship.alpha, ep);
      cx.restore();

      // Remove if off screen
      if(ship.x < -200 || ship.x > W+200 || ship.y < -200 || ship.y > H+200){
        SHIPS.splice(i, 1);
      }
    }

    requestAnimationFrame(frame);
  }
  frame();
})();

init();
</script>
</body>
</html>
